# TallyBook - 简易记账本

## 查看项目
可直接下载zip或clone git repo并使用local websever打开index.html文件查看

vs code可直接使用live server -> go live查看
（因为csv文件被放在本地文件夹中，浏览器无法直接加载）

## 基础功能：
- 首页加载bill.csv所有内容
- 可使用下拉菜单筛选月份查看当月账单内容,并统计条目数量
- 账单上方统计收入和支出情况，会随选择的月份变化
- 用户可添加新的账单和新的标签

## 使用技术栈：
- HTML, CSS, JavaScript
- 使用fetch API加载csv数据
- OS: Windows

## 需求分析及实现思路
1. 展示数据和统计支出、收入情况
展示数据是需求中最简单的部分，只需要用JS创建新的Dom并添加到父级容器中。在此思路上我根据CSV文件中的内容创建了模拟数据，以数组的形式储存，其中每一条数据为一个Object。
通过Array.reduce实现支出和收入的统计。
首先创建静态APP，所有内容以hard code实现，并调整style。
然后在通过JS将展示的内容动态创建,减少HTML中单条元素的粘贴复制。

2. 支持使用者添加账单
添加账单的部分使用form和input来获取用户输入的数据，点击添加后将获取的字段push到数组中并展示和重新统计。
其中出现的问题是点击提交后页面会跳转到新的route中，导致新添加的数据没有正常显示。
原因：form中提交的默认操作和普通的按钮不同
解决方法：阻止form中按钮的点击默认事件

3. 月份筛选
这里使用了select元素创建下拉菜单，并使用Array.filter来筛选用户选择的月份数据。筛选出的数据储存在新的数组中展示和重新统计。
在之前展示数据的时候已将时间戳创建为Date类型，此处可以用getMonth和option中的value来匹配完成筛选。

4. CSV数据加载
在上述功能全部完成之后，才开始真正读取数据，也是在这个项目中刚开始最困扰的部分。
首先由于前面功能的实现都是基于数据保存为数组形式的前提下，在读取csv数据后同样希望能保存在数组中。
刚开始使用了papaparse和d3两种插件来读取csv数据，都没有达到想要的效果。papaparse在读取bill.csv的时候会导致页面卡死，用户体验太差。d3虽然将每一条数据都读取为了object，但一次ajax完成后只读取了一条数据，无法将它们全部保存在数组中。虽然可以展示数据，但收入和支出的统计变的很麻烦所以排除。
后发现fileReader可以读取用户上传的文件并读取为String格式，是一种实现方法，但现阶段希望能够读取本地文件。
最后使用了fetch API，可以将文件作为http请求，并且fetch返回的是promise，可以避免回调地狱，在代码编写上可读性更佳。缺点是需要local server，使用了vs code中的插件解决。
将fetch的响应转换为text，并对得到的String进行处理并保存为数组。

功能全部实现后，对代码重构，并测试用户输入的边界情况。
比如type只能输入0或者1，所以将原本输入type的input改变为select，让用户选择。
同样category最开始是让用户输入对应的id，后调整为select让用户选择对应的名字。
加入提示信息。当用户创建成功后会提示创建成功字样，required的部分没有添加的时候提示对应的alert字样。
